# üìÅ Project Structure

## Overview

```
youtube-subtitle-mcp/
‚îú‚îÄ‚îÄ src/                       # TypeScript source code
‚îÇ   ‚îú‚îÄ‚îÄ index.ts              # stdio mode entry ‚≠ê (recommended for local use)
‚îÇ   ‚îú‚îÄ‚îÄ httpServer.ts         # HTTP mode entry üåê (for server deployment)
‚îÇ   ‚îî‚îÄ‚îÄ tools/                # Business logic tools
‚îÇ       ‚îú‚îÄ‚îÄ fetchYoutubeSubtitles.ts  # Main tool implementation
‚îÇ       ‚îú‚îÄ‚îÄ formatters.ts     # Format converters (SRT/VTT/TXT/JSON)
‚îÇ       ‚îî‚îÄ‚îÄ utils.ts          # Utility functions
‚îú‚îÄ‚îÄ build/                    # Compiled JavaScript (generated by TypeScript)
‚îú‚îÄ‚îÄ package.json              # Project configuration
‚îú‚îÄ‚îÄ tsconfig.json             # TypeScript configuration
‚îú‚îÄ‚îÄ .gitignore               # Git ignore rules
‚îú‚îÄ‚îÄ .env.example             # Environment variable example
‚îú‚îÄ‚îÄ LICENSE                  # Apache 2.0 License
‚îú‚îÄ‚îÄ README.md                # Main documentation
‚îú‚îÄ‚îÄ QUICKSTART.md            # Quick start guide
‚îî‚îÄ‚îÄ STRUCTURE.md             # This file
```

## üì¶ Module Descriptions

### üöÄ Entry Points

#### `src/index.ts` - stdio Mode Entry ‚≠ê

**Purpose:** Local use entry point using stdin/stdout communication

**Key Features:**
- Uses `StdioServerTransport` from MCP SDK
- Zero network configuration required
- Can be invoked via `npx -y youtube-subtitle-mcp`
- Perfect for personal use with Claude Desktop/Cursor

**Process Flow:**
1. Create MCP server instance
2. Register tool list handler (ListToolsRequestSchema)
3. Register tool call handler (CallToolRequestSchema)
4. Start stdio transport
5. Listen for JSON-RPC messages on stdin

**When to Use:**
- Personal/local use
- Quick testing
- No server infrastructure needed
- Desktop MCP clients

#### `src/httpServer.ts` - HTTP Mode Entry üåê

**Purpose:** Server deployment entry point using HTTP/JSON-RPC

**Key Features:**
- Uses Express.js for HTTP server
- Streamable HTTP transport with JSON-RPC 2.0
- Session management via `Mcp-Session-Id` header
- Health check endpoint at `/health`
- MCP endpoint at `/mcp`
- CORS support for cross-origin requests

**Endpoints:**
- `GET /health` - Health check and status
- `POST /mcp` - Main MCP JSON-RPC endpoint

**When to Use:**
- Production deployment
- Remote server access
- Multiple concurrent users
- Monitoring and scaling needed

### üõ†Ô∏è Tools Module

#### `src/tools/fetchYoutubeSubtitles.ts`

**Purpose:** Core YouTube subtitle fetching tool

**Exports:**
- `fetchYoutubeSubtitles` - Tool object with:
  - `name`: Tool identifier
  - `description`: Tool description
  - `parameters`: JSON Schema for input parameters
  - `run()`: Async function that executes the tool

**Tool Flow:**
1. **Parameter Validation** - Validate required `url` parameter
2. **Video ID Extraction** - Extract video ID from URL
3. **Transcript Fetching** - Call YouTube Transcript API
4. **Format Conversion** - Convert to requested format (SRT/VTT/TXT/JSON)
5. **Result Formatting** - Format as MCP tool result
6. **Error Handling** - Catch and format errors

**Input Parameters:**
- `url` (required): YouTube video URL or ID
- `format` (optional): Output format (default: JSON)
- `lang` (optional): Language code (default: auto-detect)

**Output:**
MCP tool result with:
- `content`: Array of text content blocks
- `isError`: Boolean indicating error state (if applicable)

#### `src/tools/formatters.ts`

**Purpose:** Convert transcript data to different subtitle formats

**Functions:**

| Function | Input | Output | Description |
|----------|-------|--------|-------------|
| `convertToSRT()` | TranscriptItem[] | string | SRT format with sequence numbers |
| `convertToVTT()` | TranscriptItem[] | string | WebVTT format for web players |
| `convertToTXT()` | TranscriptItem[] | string | Plain text (no timestamps) |
| `convertToJSON()` | TranscriptItem[] | string | JSON array with timestamps |
| `formatSubtitles()` | TranscriptItem[], format | string | Unified format converter |

**TranscriptItem Interface:**
```typescript
interface TranscriptItem {
  text: string;      // Subtitle text
  offset: number;    // Start time in milliseconds
  duration: number;  // Duration in milliseconds
}
```

**Format Examples:**

**SRT:**
```
1
00:00:00,000 --> 00:00:02,000
Hello world
```

**VTT:**
```
WEBVTT

00:00:00.000 --> 00:00:02.000
Hello world
```

**JSON:**
```json
[
  {
    "text": "Hello world",
    "start": 0,
    "end": 2000,
    "duration": 2000
  }
]
```

**TXT:**
```
Hello world
```

#### `src/tools/utils.ts`

**Purpose:** Utility functions for subtitle processing

**Functions:**

| Function | Purpose | Example |
|----------|---------|---------|
| `extractVideoId(url)` | Extract video ID from YouTube URL | `dQw4w9WgXcQ` |
| `formatSRTTime(ms)` | Format milliseconds to SRT time | `00:00:02,000` |
| `formatVTTTime(ms)` | Format milliseconds to VTT time | `00:00:02.000` |

**Supported URL Patterns:**
- `https://www.youtube.com/watch?v=VIDEO_ID`
- `https://youtu.be/VIDEO_ID`
- `https://www.youtube.com/embed/VIDEO_ID`
- `VIDEO_ID` (direct ID)

## üîÑ Data Flow

### stdio Mode Flow

```
MCP Client (Cursor/Claude Desktop)
    ‚Üì stdin (JSON-RPC)
src/index.ts (StdioServerTransport)
    ‚Üì
MCP Server (ListTools / CallTool)
    ‚Üì
tools/fetchYoutubeSubtitles.ts
    ‚Üì
tools/utils.ts (extractVideoId)
    ‚Üì
youtube-transcript library
    ‚Üì
tools/formatters.ts (format conversion)
    ‚Üì stdout (JSON-RPC result)
MCP Client
```

### HTTP Mode Flow

```
MCP Client (HTTP Request)
    ‚Üì POST /mcp
src/httpServer.ts (Express)
    ‚Üì
Session Management (Mcp-Session-Id)
    ‚Üì
MCP Server (JSON-RPC handler)
    ‚Üì
tools/fetchYoutubeSubtitles.ts
    ‚Üì
tools/utils.ts (extractVideoId)
    ‚Üì
youtube-transcript library
    ‚Üì
tools/formatters.ts (format conversion)
    ‚Üì HTTP Response (JSON-RPC result)
MCP Client
```

## üîß Build Process

### TypeScript Compilation

```bash
npm run build
```

**Steps:**
1. `tsc` - Compile TypeScript to JavaScript (src/ ‚Üí build/)
2. `chmod +x` - Make entry files executable (for npx)

**Output:**
- `build/index.js` - stdio mode executable
- `build/httpServer.js` - HTTP mode executable
- `build/tools/*.js` - Tool modules
- `build/**/*.d.ts` - Type declaration files
- `build/**/*.js.map` - Source maps

### Package Configuration

**Key `package.json` Fields:**

```json
{
  "type": "module",              // Enable ES modules
  "bin": {
    "youtube-subtitle-mcp": "./build/index.js",
    "youtube-subtitle-mcp-http": "./build/httpServer.js"
  },
  "files": ["build"],            // Only publish build/ directory
  "scripts": {
    "build": "...",              // Compile + make executable
    "prepare": "npm run build"   // Auto-build on npm install
  }
}
```

## üìö Dependencies

### Production Dependencies

| Package | Version | Purpose |
|---------|---------|---------|
| `@modelcontextprotocol/sdk` | 0.6.0 | MCP protocol implementation |
| `youtube-transcript` | ^1.2.1 | YouTube transcript fetching |
| `express` | ^4.19.2 | HTTP server (HTTP mode) |
| `cors` | ^2.8.5 | CORS support (HTTP mode) |
| `dotenv` | ^16.3.1 | Environment variables |

### Development Dependencies

| Package | Version | Purpose |
|---------|---------|---------|
| `typescript` | ^5.3.3 | TypeScript compiler |
| `@types/node` | ^20.11.24 | Node.js type definitions |
| `@types/express` | ^4.17.21 | Express type definitions |
| `@types/cors` | ^2.8.17 | CORS type definitions |

## üöÄ Deployment Modes

### stdio Mode Deployment

**Local Development:**
```bash
npm run start:stdio
```

**Global Installation:**
```bash
npm install -g youtube-subtitle-mcp
youtube-subtitle-mcp
```

**npx Usage (Recommended):**
```bash
npx -y youtube-subtitle-mcp
```

**Configuration:**
```json
{
  "mcpServers": {
    "youtube-subtitle": {
      "command": "npx",
      "args": ["-y", "youtube-subtitle-mcp"]
    }
  }
}
```

### HTTP Mode Deployment

**Local Development:**
```bash
npm run start:http
```

**Production with PM2:**
```bash
pm2 start build/httpServer.js --name youtube-subtitle-mcp
```

**Docker:**
```bash
docker build -t youtube-subtitle-mcp .
docker run -p 3000:3000 youtube-subtitle-mcp
```

**Configuration:**
```json
{
  "mcpServers": {
    "youtube-subtitle": {
      "type": "streamableHttp",
      "url": "http://localhost:3000/mcp"
    }
  }
}
```

## üéØ Design Principles

1. **Modularity**: Each tool is self-contained and independent
2. **Dual Mode**: Support both stdio and HTTP for flexibility
3. **Type Safety**: Full TypeScript with strict mode enabled
4. **Error Handling**: Comprehensive error handling and user-friendly messages
5. **Zero Config**: stdio mode works with zero configuration
6. **Production Ready**: HTTP mode ready for production deployment
7. **Extensible**: Easy to add new tools following the same pattern

## üìù Adding New Tools

To add a new tool to this MCP server:

1. **Create tool file**: `src/tools/myNewTool.ts`

```typescript
export const myNewTool = {
  name: "my_new_tool",
  description: "Tool description",
  parameters: {
    type: "object",
    properties: {
      param1: {
        type: "string",
        description: "Parameter description"
      }
    },
    required: ["param1"]
  },
  
  async run(args: { param1: string }) {
    // Implementation
    return {
      content: [{
        type: "text",
        text: "Result"
      }]
    };
  }
};
```

2. **Import in entry files**: Add to `src/index.ts` and `src/httpServer.ts`

```typescript
import { myNewTool } from "./tools/myNewTool.js";
```

3. **Register tool**: Add to tool list and call handler

4. **Build and test**: `npm run build && npm run start:stdio`

---

**That's the complete architecture! üéâ**
